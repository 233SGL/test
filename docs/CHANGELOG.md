# 更新日志 (CHANGELOG)

本文档记录 **鹤山积分管理系统** 的所有重要更新。

---

## v1.4.2 (2025-12-10)

### 🔐 安全修复

- **移除默认密码提示** - 登录页不再显示 "(默认: 1234)" 提示
- **Supabase 函数安全修复** - 为 `calculate_production_equivalent` 设置安全的 `search_path`

### ✨ 新功能

- **机台管理刷新按钮** - 页面右上角添加刷新按钮，支持手动刷新数据

### 🔧 修复

- **机台数据保存修复** - 后端 API 支持 `effectiveWidth` 和 `speedWeftPerMin` 字段
- **前端编辑框修复** - 正确发送有效幅宽到 API
- **数据库时间戳修复** - 添加 `updated_at` 自动更新触发器
- **API 返回时间戳** - 所有 GET API 返回 `createdAt`/`updatedAt` 字段

### 📄 文档更新

- 同步 API 文档与前端功能
- 机台更新 API 添加新字段说明
- 审计日志 API 添加 search/dateFrom/dateTo 参数

---

## v1.4.1 (2025-12-10)

### 🎨 界面优化

- **审计日志筛选增强**
  - 新增搜索框（支持用户名/目标名称）
  - 新增日期范围选择器
  - 新增操作类型：登录失败、备份、恢复、管理访问
  - 新增目标类型：备份、系统、织造相关类型

- **数据库查看器改进**
  - 移除列宽截断限制，完整显示数据
  - 日期字段自动格式化
  - 对象数据特殊样式显示

- **月份选择器统一样式**
  - 织造工段页面添加日历图标
  - 月度汇总、生产记录、奖金核算

---

## v1.4.0-安全加固 (2025-12-10)

### 🔐 安全加固

- **API 权限验证** - 敏感 API 需要 `MANAGE_EMPLOYEES` 或 `MANAGE_SYSTEM` 权限
- **登录速率限制** - 5 次失败后锁定 15 分钟，防止暴力破解
- **Supabase RLS** - 为 15 个表启用行级安全策略
- **数据库视图修复** - 修复 SECURITY DEFINER 视图

---

## v1.3.1-体验优化 (2025-12-09)

### ✨ 功能增强

- **织造奖金核算** - 支持手动录入目标产量，新增参数配置面板
- **员工管理UI重构** - 全新设计的工具栏，集成搜索、排序与批量管理
- **文件结构清理** - 移除冗余文件

---

## v1.3.0-织造生产管理 (2025-12-06)

### 🔧 修复与优化

- 修复 API 地址统一使用相对路径
- 修复 TypeScript 类型错误
- 清理未使用的导入
- 优化等效产量卡片显示

### 📊 织造工段考核方案

- 成网率质量奖计算
- 运转率奖计算
- 二次分配（班长1.3，班员1.0）
- 单机台目标 6450㎡

---

## v1.2.0-织造生产管理 (2025-12-05)

### 🆕 新增功能

- 织造工段 6 个管理页面
  - 生产录入：每张网录入一条记录
  - 生产记录：按月查看和删除记录
  - 月度汇总：统计当月生产数据
  - 奖金计算：成网率/运转率奖金计算
  - 机台管理：11台机台状态监控
  - 网种管理：产品纬密配置

---

## v1.1.0-后台管理 (2025-12-04)

### 🆕 新增功能

- 审计日志 (Audit Logs) 页面
- 数据库查看器 (Database Viewer)
- 员工批量管理模式

---

## v1.0.0-初始版本 (2025-11)

### 核心功能

- 定型工段积分计算
- 每日工时管理
- 生产数据录入
- 模拟沙箱
- 员工档案管理
- 系统用户权限管理
