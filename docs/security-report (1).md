# 安全

**Generated At:** 2025/12/10 08:44:35
**风险等级:** 严重

## 评估摘要

本次代码安全分析发现了一些严重的安全漏洞，主要集中在用户认证、数据保护和配置管理方面。攻击者可能通过窃取密码、绕过验证或注入恶意内容来完全控制系统，窃取或破坏所有数据。这些漏洞需要立即修复。

## 发现的安全问题 (13)

### 1. 任何人都可以通过查看浏览器代码窃取所有用户的登录密码（PIN码）

- **类别:** Authentication & Authorization
- **严重性:** 严重
- **文件:** src/pages/auth/Login.tsx
- **行数:** 59

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 用户的登录密码（PIN码）在登录时直接在用户的浏览器中进行验证，而不是在安全的服务器上。这意味着所有用户的PIN码都可能被加载到浏览器内存中，或者通过浏览器开发者工具被轻易查看。攻击者如果能访问用户的电脑，或者通过其他方式在浏览器中执行恶意代码，就可以直接窃取所有用户的PIN码，从而登录他们的账户。这就像您把所有银行卡的密码都写在了一张纸上，然后把这张纸放在了公共场合。

**建议修复:** 所有的登录验证，包括PIN码验证，都必须在安全的服务器端进行 (What)。浏览器只负责发送用户输入的PIN码的加密哈希值，服务器接收后与存储的哈希值进行比对，而不是直接发送或存储明文PIN码。(Why) 如果继续在客户端验证PIN码，攻击者可以轻易窃取所有用户的登录凭据，导致大规模账户被盗，严重损害用户隐私和系统安全。(Without)

**Why this matters:** 这能彻底保护所有用户的登录密码不被窃取，是系统安全最基本的保障。

### 2. 任何人都可以使用代码中写死的密码恢复或删除所有数据

- **类别:** Configuration & Dependencies
- **严重性:** 严重
- **文件:** src/pages/system/Settings.tsx
- **行数:** 146

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 在恢复数据库备份时，系统会要求输入一个管理员密码（PIN码）进行确认。然而，这个密码“1234”是直接写在代码文件里的。这意味着任何能够看到这段代码的人，或者通过简单猜测，都可以使用这个密码来恢复或删除整个数据库的所有数据。这就像您把银行金库的密码直接写在了金库门上，任何人都能看到并使用。

**建议修复:** 立即移除代码中硬编码的管理员密码 (What)。数据库恢复和删除操作必须通过安全的服务器端验证机制，例如要求当前登录管理员重新输入其个人密码，并且该密码应通过加密传输和存储。(Why) 如果不移除这个硬编码密码，攻击者可以轻易地破坏您的整个数据库，导致数据丢失、系统瘫痪，甚至被恶意篡改。(Without)

**Why this matters:** 这是保护您所有数据不被恶意破坏的最后一道防线，必须绝对安全。

### 3. 任何人都可以查看数据库中所有表的结构和数据

- **类别:** Data Protection
- **严重性:** 严重
- **文件:** src/pages/admin/DatabaseViewer.tsx
- **行数:** 10-12

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 这个页面允许管理员查看数据库中任何表的结构和存储的数据。虽然它受到管理员登录的保护，但如果攻击者设法绕过登录验证，或者一个权限较低的管理员账户被攻破，他们就可以访问到所有敏感信息，包括用户密码哈希、个人身份信息、财务数据等。这就像把银行金库的钥匙交给了所有员工，一旦钥匙落入坏人之手，所有资产都将面临风险。

**建议修复:** 在后端严格限制和验证可访问的数据库表名，并确保只有最高权限的系统管理员才能访问此功能 (What)。同时，对所有数据库查询进行参数化处理，以防止 SQL 注入攻击。(Why) 如果不这样做，攻击者可能通过这个功能窃取或篡改数据库中的所有数据，导致严重的数据泄露和系统崩溃。(Without)

**Why this matters:** 这能确保您的数据库核心数据不被未授权访问，保护所有敏感信息。

### 4. 任何人都可以通过拦截网络请求窃取管理员密码

- **类别:** Authentication & Authorization
- **严重性:** 高
- **文件:** src/components/AdminGuard.tsx
- **行数:** 49-56

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 当管理员访问敏感页面时，系统会要求输入密码进行二次验证。这个密码会直接从浏览器发送到服务器。如果攻击者能够拦截到这段网络通信（例如在不安全的网络环境下），他们就可以直接获取到管理员的密码。这就像您在公共场合大声说出您的银行卡密码一样危险。

**建议修复:** 不要直接发送密码进行二次验证。应该在用户登录时生成一个临时的、短期的安全令牌，并在需要二次验证时使用这个令牌。这个令牌应该有严格的有效期和使用次数限制，并且在每次使用后都应刷新。(What) 这样即使令牌被窃取，也只能在很短的时间内进行有限的操作，大大降低了风险。(Why) 如果继续直接发送密码，攻击者一旦窃取，就可以永久拥有您的管理员权限，对系统造成不可逆的破坏。(Without)

**Why this matters:** 这能保护您的管理员账户不被轻易窃取，确保系统最高权限的安全。

### 5. 任何人都可以通过发布公告在系统大屏上注入恶意代码

- **类别:** Input Validation & Sanitization
- **严重性:** 高
- **文件:** src/pages/styling/StylingSettings.tsx
- **行数:** 40

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 系统允许管理员发布公告，这些公告内容会直接显示在车间大屏的滚动通知上。如果攻击者能够发布包含恶意代码（例如JavaScript脚本）的公告，这些代码就会在大屏上执行，从而窃取查看者的信息、篡改页面内容，甚至重定向用户到恶意网站。这就像在公共广播系统里播放了虚假或有害的信息，影响所有听到的人。

**建议修复:** 在保存和显示公告内容之前，对所有用户输入进行严格的清理和验证 (What)。确保任何可能被解释为代码的特殊字符都被转换成无害的文本，防止恶意脚本的执行。(Why) 如果不进行清理，攻击者可以利用这个漏洞在大屏上执行恶意代码，对所有查看者造成危害，损害系统信誉。(Without)

**Why this matters:** 这能保护系统大屏不被恶意代码攻击，确保显示内容的真实性和安全性。

### 6. 任何人都可以通过导入恶意文件破坏产品数据或系统

- **类别:** Input Validation & Sanitization
- **严重性:** 高
- **文件:** src/pages/weaving/ProductManagement.tsx
- **行数:** 114-116

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 系统允许用户通过导入 CSV 或 TXT 文件来批量添加或更新产品信息。虽然前端对文件格式进行了一些检查，但如果导入的文件中包含恶意构造的数据（例如超长字符串、特殊字符或潜在的注入内容），这些数据在未经充分清理的情况下被发送到后端并保存到数据库，就可能导致数据库损坏、系统崩溃，甚至被攻击者利用进行更深层次的攻击。这就像您允许任何人往您的文件柜里随意塞入任何文件，而没有检查这些文件是否安全或有害。

**建议修复:** 在后端接收到导入数据后，必须对所有字段进行严格的验证和清理 (What)。确保数据符合预期的格式和长度，并对所有特殊字符进行适当的转义，以防止任何形式的注入攻击和数据异常。(Why) 如果不这样做，恶意文件可能导致产品数据被破坏，影响生产计算，甚至危及整个系统的稳定性和安全性。(Without)

**Why this matters:** 这能保护您的产品数据不被恶意文件破坏，确保生产计算的准确性。

### 7. 任何人都可以将模拟数据直接应用到正式生产数据中

- **类别:** Business Logic & Flow
- **严重性:** 高
- **文件:** src/pages/styling/Simulation.tsx
- **行数:** 108-113

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 这个页面允许用户调整各种参数进行积分模拟计算。更重要的是，它提供了一个“应用到生产”的功能，可以将模拟的参数直接覆盖到正式的生产数据中。如果拥有“应用模拟”权限的用户账户被攻破，或者权限管理不当，攻击者就可以随意修改生产数据，导致积分计算错误，甚至影响员工薪资。这就像一个学生在草稿纸上修改了考试答案，然后直接把草稿纸上的答案作为正式答案提交了。

**建议修复:** 确保“应用到生产”功能有严格的权限控制，并且在执行前进行二次验证 (What)。同时，所有对生产数据的修改都应该有详细的审计日志记录，以便追踪和回溯。(Why) 如果没有严格的控制，恶意用户或被攻破的账户可以轻易篡改生产数据，造成严重的财务损失和数据混乱。(Without)

**Why this matters:** 这能确保只有经过授权的人才能修改正式的生产数据，防止恶意篡改和财务损失。

### 8. 重命名部门文件夹可能导致数据不一致

- **类别:** Business Logic & Flow
- **严重性:** 中
- **文件:** src/pages/system/Employees.tsx
- **行数:** 304-319

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 当您重命名一个部门文件夹时，系统会先创建一个新名称的文件夹，然后尝试更新所有属于旧文件夹的员工记录，最后再删除旧文件夹。这个过程不是一个原子操作（即不能保证全部成功或全部失败）。如果在这个过程中任何一步失败，例如网络中断或数据库错误，就可能导致部分员工仍然关联到旧文件夹，或者新文件夹创建失败但旧文件夹已被删除，从而造成数据混乱和不一致。这就像您在搬家时，先搬走一部分家具，然后才去办理新地址手续，如果中间出了问题，您的家具可能就散落在两处。

**建议修复:** 确保重命名文件夹的操作是一个原子事务 (What)。这意味着所有步骤要么全部成功，要么全部失败并回滚到初始状态，以保证数据的一致性。这通常需要在后端实现一个专门的重命名接口。(Why) 如果不这样做，数据可能会变得混乱，导致员工信息查询错误，影响后续的积分计算和管理。(Without)

**Why this matters:** 这能确保您的员工数据始终保持准确和一致，避免因操作失败导致的信息混乱。

### 9. 织造工段的配置更改不会被保存

- **类别:** Business Logic & Flow
- **严重性:** 中
- **文件:** src/pages/weaving/BonusCalculation.tsx
- **行数:** 469

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 在织造工段的奖金核算页面中，有一个配置弹窗允许用户修改各种计算参数，例如成网率基准、奖金单价等。然而，这些修改目前只在浏览器中生效，并不会被保存到服务器。这意味着一旦页面刷新或用户离开该页面，所有修改的配置都将丢失，系统会恢复到默认设置。这就像您在电脑上修改了文件，但没有点击保存，导致所有修改都白费了。

**建议修复:** 确保配置弹窗中的所有更改都能被安全地保存到后端数据库 (What)。这需要实现一个后端API来接收并持久化这些配置，并且在保存前进行严格的权限验证。(Why) 如果不保存这些配置，用户每次都需要重新输入，不仅效率低下，还可能导致计算结果不一致，影响奖金核算的准确性。(Without)

**Why this matters:** 这能确保您对织造工段参数的修改能够被系统记住，避免重复操作和数据不一致。

### 10. 织造工段的生产数据录入后不会被保存

- **类别:** Business Logic & Flow
- **严重性:** 中
- **文件:** src/pages/weaving/DataEntry.tsx
- **行数:** 409

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 在织造工段的数据录入页面中，用户可以输入各项生产指标和机台产量。页面底部有一个“保存数据”按钮，但目前这个按钮没有实际的保存功能。这意味着用户输入的所有数据在页面刷新或离开后都会丢失，无法持久化。这就像您填写了一份重要的表格，但最后没有提交，导致所有努力都白费了。

**建议修复:** 为“保存数据”按钮添加实际的后端保存逻辑 (What)。确保用户输入的所有生产数据都能被安全地存储到数据库中，并且在保存前进行严格的权限验证和数据校验。(Why) 如果不保存这些数据，织造工段的生产记录将无法被追踪和分析，奖金核算也将缺乏依据，严重影响业务流程。(Without)

**Why this matters:** 这能确保织造工段的生产数据被系统记录下来，为后续的分析和奖金核算提供准确依据。

### 11. 任何人都可以通过猜测ID来访问或修改数据 (潜在风险)

- **类别:** Data Protection
- **严重性:** 低
- **文件:** src/contexts/DataContext.tsx
- **行数:** 60

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 系统使用简单的随机数来生成员工、工段等数据的唯一标识符（ID）。这种生成方式不够安全，攻击者有可能通过猜测或暴力破解的方式生成有效的ID。如果这些ID被用于访问或修改敏感数据，攻击者就可能绕过权限检查，访问或篡改不属于他们的数据。这就像您用一个非常简单的数字序列作为银行卡密码，很容易被别人猜到。

**建议修复:** 对于所有敏感数据和用户可访问的资源，使用更复杂、更难猜测的唯一标识符，例如 UUID (Universally Unique Identifier) (What)。这能大大增加攻击者猜测有效ID的难度，从而保护您的数据不被未授权访问或篡改。(Why) 如果继续使用简单的随机数ID，一旦攻击者猜中，就可能导致数据泄露或篡改，严重影响系统安全和数据完整性。(Without)

**Why this matters:** 这能有效防止攻击者通过猜测数据编号来窃取或修改您的重要信息。

### 12. 管理员班组信息和职位配置直接写在代码里

- **类别:** Configuration & Dependencies
- **严重性:** 低
- **文件:** src/components/weaving/WeavingResults.tsx
- **行数:** 15

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 管理员班组的成员名单、职位信息以及织造工段的职位配置（例如“管理员班长”、“管理员班员”等）都直接写在了代码文件里。这意味着如果这些信息需要修改，每次都需要修改代码并重新部署，非常不灵活。

**建议修复:** 将管理员班组的成员名单和职位配置存储在数据库或独立的配置文件中 (What)。这样，当人员变动或职位名称需要调整时，您可以通过管理界面轻松更新，而无需修改代码。(Why) 如果这些信息直接写在代码里，每次修改都需要开发人员介入，耗时耗力，并且容易出错。(Without)

**Why this matters:** 这能让系统更灵活，方便您管理人员信息和职位设置，减少维护成本。

### 13. 核心工段的标识符直接写在代码里

- **类别:** Configuration & Dependencies
- **严重性:** 低
- **文件:** src/contexts/DataContext.tsx
- **行数:** 285

**由 Zeabur Agent 深入分析您的 GitHub 项目，在潜在风险成为问题前，主动发掘并提供修复建议。:** 系统中“定型工段”和“织造工段”被标记为核心工段，其标识符（`styling`和`weaving`）直接写在了代码文件里。这意味着如果未来需要修改这些核心工段的标识符，或者增加新的核心工段，每次都需要修改代码并重新部署，非常不灵活。

**建议修复:** 将核心工段的标识符存储在数据库或独立的配置文件中 (What)。这样，当需要调整核心工段列表时，您可以通过管理界面轻松更新，而无需修改代码。(Why) 如果这些标识符直接写在代码里，每次修改都需要开发人员介入，耗时耗力，并且容易出错。(Without)

**Why this matters:** 这能让系统更灵活，方便您管理核心工段信息，减少维护成本。

## 一般建议

1. 立即修复所有关键和高风险漏洞，特别是客户端PIN码验证和硬编码管理员密码的问题。
2. 对所有用户输入进行严格的服务器端验证和清理，防止注入攻击和恶意内容。
3. 确保所有敏感操作（如数据库恢复、生产数据修改）都有严格的权限控制和二次验证机制，并记录详细的审计日志。
4. 将所有硬编码的配置参数（如管理员班组信息、核心工段标识符）迁移到数据库或可配置的文件中，提高系统的灵活性和可维护性。
5. 对于涉及数据持久化的功能（如织造工段配置和数据录入），确保后端保存逻辑已正确实现并经过测试。
6. 加强后端API的安全性，对所有接口进行身份验证、授权检查和输入验证，防止未经授权的访问和数据篡改。

## 分析信息

**分析文件数量:** 30
**分析文件:**
- src/App.tsx
- src/components/AdminGuard.tsx
- src/components/MetricCard.tsx
- src/components/Sidebar.tsx
- src/components/weaving/EquivalentOutputCalculator.tsx
- src/components/weaving/WeavingConfiguration.tsx
- src/components/weaving/WeavingDataEntry.tsx
- src/components/weaving/WeavingResults.tsx
- src/contexts/AuthContext.tsx
- src/contexts/DataContext.tsx
- src/index.tsx
- src/pages/admin/AuditLogs.tsx
- src/pages/admin/Dashboard.tsx
- src/pages/admin/DatabaseViewer.tsx
- src/pages/auth/Login.tsx
- src/pages/styling/Attendance.tsx
- src/pages/styling/Dashboard.tsx
- src/pages/styling/ProductionData.tsx
- src/pages/styling/SalaryCalculator.tsx
- src/pages/styling/Simulation.tsx
- src/pages/styling/StylingSettings.tsx
- src/pages/system/Employees.tsx
- src/pages/system/Settings.tsx
- src/pages/weaving/BonusCalculation.tsx
- src/pages/weaving/Calculator.tsx
- src/pages/weaving/Configuration.tsx
- src/pages/weaving/DataEntry.tsx
- src/pages/weaving/MachineManagement.tsx
- src/pages/weaving/MonthlySummary.tsx
- src/pages/weaving/ProductManagement.tsx

**原始产生时间:** 2025/12/10 08:43:14
